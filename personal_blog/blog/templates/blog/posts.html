{% extends 'blog/base_admin.html' %}
{% block title %}Posts | Admin Dashboard{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
  <h2 class="fw-semibold mb-0">Manage Posts</h2>
  <a href="{% url 'add_post' %}" class="btn btn-primary">
    <i class="bi bi-plus-circle me-1"></i>New Post
  </a>
</div>

<!-- Filter & Search -->
<form method="get" class="row g-2 mb-4">
  <div class="col-md-4">
    <input type="text" name="q" class="form-control" placeholder="Search posts..." value="{{ request.GET.q }}">
  </div>
  <div class="col-md-3">
    <select name="status" class="form-select">
      <option value="">All Statuses</option>
      <option value="published" {% if request.GET.status == 'published' %}selected{% endif %}>Published</option>
      <option value="draft" {% if request.GET.status == 'draft' %}selected{% endif %}>Draft</option>
      <option value="pending" {% if request.GET.status == 'pending' %}selected{% endif %}>Pending</option>
    </select>
  </div>
  <div class="col-md-3">
    <select name="sort" class="form-select">
      <option value="-created_at" {% if request.GET.sort == '-created_at' %}selected{% endif %}>Newest First</option>
      <option value="created_at" {% if request.GET.sort == 'created_at' %}selected{% endif %}>Oldest First</option>
      <option value="title" {% if request.GET.sort == 'title' %}selected{% endif %}>Title (Aâ€“Z)</option>
    </select>
  </div>
  <div class="col-md-2 d-grid">
    <button class="btn btn-outline-primary" type="submit">
      <i class="bi bi-funnel"></i> Apply
    </button>
  </div>
</form>

<!-- Table -->
<div class="card p-4 shadow-sm">
  <table class="table table-hover align-middle">
    <thead>
      <tr>
        <th>Title</th>
        <th>Author</th>
        <th>Date</th>
        <th>Status</th>
        <th class="text-center">Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for post in posts %}
      <tr>
        <td>{{ post.title }}</td>
        <td>{{ post.author.username }}</td>
        <td>{{ post.created_at|date:"M d, Y" }}</td>
        <td>
          {% if post.status == 'published' %}
            <span class="badge bg-success">Published</span>
          {% elif post.status == 'draft' %}
            <span class="badge bg-secondary">Draft</span>
          {% else %}
            <span class="badge bg-warning text-dark">Pending</span>
          {% endif %}
        </td>
        <td class="text-center">
          <a href="{% url 'post_detail' post.id %}" target="_blank" class="btn btn-outline-info btn-sm"><i class="bi bi-eye"></i></a>
          <a href="{% url 'edit_post' post.id %}" class="btn btn-outline-warning btn-sm"><i class="bi bi-pencil-square"></i></a>
          <form action="{% url 'delete_post' post.id %}" method="post" class="d-inline">
            {% csrf_token %}
            <button type="submit" class="btn btn-outline-danger btn-sm" onclick="return confirm('Delete this post?');">
              <i class="bi bi-trash"></i>
            </button>
          </form>
        </td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="5" class="text-center text-muted">No posts found.</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <!-- Pagination -->
  {% if posts.has_other_pages %}
  <nav>
    <ul class="pagination justify-content-center mt-3">
      {% if posts.has_previous %}
        <li class="page-item"><a class="page-link" href="?page={{ posts.previous_page_number }}&q={{ request.GET.q }}&status={{ request.GET.status }}&sort={{ request.GET.sort }}">Previous</a></li>
      {% endif %}

      <li class="page-item active"><a class="page-link">{{ posts.number }}</a></li>

      {% if posts.has_next %}
        <li class="page-item"><a class="page-link" href="?page={{ posts.next_page_number }}&q={{ request.GET.q }}&status={{ request.GET.status }}&sort={{ request.GET.sort }}">Next</a></li>
      {% endif %}
    </ul>
  </nav>
  {% endif %}
</div>
{% endblock %}
